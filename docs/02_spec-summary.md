# interactive-log-masking-cli ｜仕様まとめ

## 1. アプリ概要

ログファイル（またはログディレクトリ）に含まれる情報を、指定したルールに従ってマスキング（置換）し、 `out/` 配下へ出力する。

- 個人情報（メール/電話/ID 等）に限らず、**任意の文字列・トークン・識別子**を対象にできる
- CLI は **対話形式**で実行計画（入力・出力・ルール・dryRun など）を確定してから実行する

---

## 2. 想定実行環境

- OS: Windows / macOS / Linux
- Java: **21**
- ビルド/実行: Gradle（Gradle Wrapper）
- JSON: Jackson
- テスト: JUnit 5

---

## 3. スコープ（できること）

- 入力パス（ファイル or ディレクトリ）を受け取り、ディレクトリは**再帰的にファイルを列挙**して処理
- マスキングルールを以下から指定
  - JSON 設定ファイル（例: `rules/mask-rules.json`）
  - 対話でルールを作成（必要なら JSON として保存）
- 出力は `out/` 配下に **構造維持**して生成
- 出力ファイル名に **サフィックス付与**（例: `_masked`）が可能
- dryRun（件数集計のみ）に対応（ファイルは生成しない）
- 実行結果レポートを `out/` 配下に **report-\*.json** として出力（dryRun でも出力する）

---

## 4. 入出力仕様

### 4.1 入力（inputPath）

- 入力は **ファイル**または**ディレクトリ**を指定できる
- ディレクトリの場合は `Files.walk` 相当で再帰的に探索し、**通常ファイルのみ**を対象とする（フォルダ自体は加工しない）

### 4.2 出力（outRoot）

- 出力先は「出力先ディレクトリ（out 配下）」として指定する
- 出力は **常に outRoot 配下**に作られる（入力ファイル自体は変更しない）
- 出力先ディレクトリが存在しない場合は必要に応じて作成する

### 4.3 構造維持（ディレクトリ入力時）

入力がディレクトリの場合、`outRoot` 配下に **入力からの相対パス構造を維持**して出力する。

例:

- 入力: `input/sample/api/access-2026-01-05.log`
- 出力: `out/sample/api/access-2026-01-05_masked.log`（サフィックス付与時の例）

### 4.4 出力ファイル名サフィックス（任意）

- サフィックス付与を有効にした場合、**拡張子の直前**にサフィックスを挿入する
- 拡張子が無い場合は末尾に付与する
- ドットで始まるファイル（例: `.env`）も想定し、名前を崩さない形で付与する

例（サフィックス `_masked`）:

- `app.log` → `app_masked.log`
- `quick` → `quick_masked`
- `.env` → `.env_masked`

### 4.5 文字コード

- 読み込み: UTF-8
- 書き込み: UTF-8

---
